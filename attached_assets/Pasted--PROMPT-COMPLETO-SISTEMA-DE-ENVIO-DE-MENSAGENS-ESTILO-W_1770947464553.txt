# üöÄ PROMPT COMPLETO - SISTEMA DE ENVIO DE MENSAGENS ESTILO WHATSAPP

**Cole este prompt no Replit AI:**

```
Implemente um sistema COMPLETO de envio de mensagens estilo WhatsApp na tela de Conversas.

REQUISITOS OBRIGAT√ìRIOS:

1. √ÅREA DE INPUT DE MENSAGEM (bottom fixo do chat):

Layout horizontal com os seguintes elementos (da esquerda para direita):

a) Bot√£o de Anexar (√≠cone Paperclip):
   - Click: abre menu popup acima do bot√£o
   - Menu com 4 op√ß√µes em grid 2x2:
     * üì∑ Foto/V√≠deo (aceita image/*, video/*)
     * üéµ √Åudio (aceita audio/*)
     * üìÑ Documento (aceita .pdf, .doc, .docx, .xls, .xlsx, .zip)
     * üé§ Gravar √Åudio (inicia grava√ß√£o)
   - Cada op√ß√£o com √≠cone colorido + label
   - Click em qualquer op√ß√£o: abre file picker OU inicia grava√ß√£o

b) Textarea auto-expans√≠vel:
   - Placeholder: "Digite uma mensagem..."
   - Auto-expand at√© max 5 linhas
   - Shift+Enter: quebra linha
   - Enter: envia mensagem
   - Background: white
   - Border radius arredondado
   - Padding generoso

c) Bot√£o de Emoji:
   - √çcone Smile
   - Click: abre emoji picker (usar emoji-picker-react)
   - Insere emoji na posi√ß√£o do cursor

d) Bot√£o de Enviar:
   - √çcone Send
   - Cor azul (#2563EB)
   - Disabled se n√£o tem texto E n√£o tem arquivos
   - Loading spinner durante envio
   - S√≥ aparece quando tem conte√∫do (texto ou arquivos)

2. UPLOAD DE ARQUIVOS:

Suporte a m√∫ltiplos arquivos simultaneamente com preview:

a) Drag & Drop:
   - Toda √°rea do chat aceita drag & drop
   - Visual feedback quando arrasta arquivo sobre a √°rea
   - Overlay semi-transparente com texto "Solte aqui para anexar"

b) Preview de Arquivos (aparece ACIMA do input):
   - Container horizontal scroll se houver m√∫ltiplos arquivos
   - Cada arquivo mostra:
     
     IMAGEM:
     - Thumbnail (120x120px, object-cover, rounded)
     - Bot√£o X no canto superior direito para remover
     - Input opcional para caption (abaixo da imagem)
     - Click na imagem: abre em tamanho maior
     
     V√çDEO:
     - Thumbnail com √≠cone play sobreposto
     - Dura√ß√£o do v√≠deo no canto inferior
     - Bot√£o X para remover
     - Input opcional para caption
     
     √ÅUDIO:
     - Card com √≠cone de √°udio
     - Nome do arquivo
     - Tamanho do arquivo
     - Dura√ß√£o (se detect√°vel)
     - Bot√£o X para remover
     
     DOCUMENTO:
     - Card com √≠cone do tipo (PDF, Word, Excel)
     - Nome do arquivo truncado
     - Tamanho em KB/MB
     - Bot√£o X para remover

   - M√°ximo 10 arquivos por vez
   - Tamanho m√°ximo por arquivo:
     * Imagens: 5MB
     * V√≠deos: 16MB
     * √Åudios: 16MB
     * Documentos: 10MB
   - Valida√ß√£o de tamanho com mensagem de erro

3. GRAVA√á√ÉO DE √ÅUDIO:

Interface completa de grava√ß√£o de √°udio:

a) Ao clicar em "Gravar √Åudio":
   - Solicita permiss√£o do microfone
   - Textarea some
   - Bot√£o anexar some
   - Aparece interface de grava√ß√£o:
     
     * Waveform animado em tempo real (usar wavesurfer.js)
     * Timer de grava√ß√£o (formato: 0:00)
     * Bot√£o Pause/Resume (√≠cone Pause/Play)
     * Bot√£o Cancelar (√≠cone X, volta ao normal)
     * Bot√£o Finalizar (√≠cone Check, salva √°udio)

b) Durante grava√ß√£o:
   - Waveform animado mostrando ondas sonoras
   - Timer contando em tempo real
   - Limit m√°ximo: 5 minutos (auto-stop)
   - Visual feedback: pulsando em vermelho

c) Ap√≥s finalizar:
   - Preview do √°udio gravado
   - Player com:
     * Bot√£o play/pause
     * Waveform clic√°vel (seek)
     * Dura√ß√£o total
     * Bot√£o para re-gravar
     * Bot√£o para enviar
     * Bot√£o para cancelar

d) Salvar √°udio:
   - Formato: WebM ou OGG
   - Converter para formato compat√≠vel com WhatsApp se necess√°rio
   - Upload para Supabase Storage
   - Enviar via API

4. ENVIO DE MENSAGENS:

L√≥gica completa de envio:

a) Valida√ß√µes:
   - Se tem texto: enviar como mensagem de texto
   - Se tem arquivos: fazer upload primeiro, depois enviar
   - Se tem texto + arquivos: enviar arquivos com caption
   - Bloquear envio duplicado (debounce)

b) Upload de arquivos:
   - Upload sequencial ou paralelo para Supabase Storage
   - Progress bar para cada arquivo
   - Se falhar: mostrar erro espec√≠fico do arquivo
   - Retry autom√°tico 1x

c) Chamada API:
   - Para cada tipo de m√≠dia, enviar via endpoint correto:
     * Texto: POST /webhook/whatsapp/send com tipo "text"
     * Imagem: POST /webhook/whatsapp/send com tipo "image" + midiaUrl
     * V√≠deo: POST /webhook/whatsapp/send com tipo "video" + midiaUrl
     * √Åudio: POST /webhook/whatsapp/send com tipo "audio" + midiaUrl
     * Documento: POST /webhook/whatsapp/send com tipo "document" + midiaUrl

d) Feedback visual:
   - Loading spinner no bot√£o enviar
   - Mensagem aparece instantaneamente no chat (otimistic UI)
   - Status "enviando..." na mensagem
   - Quando API retorna sucesso: muda para "enviada" com 1 check
   - Toast de sucesso: "Mensagem enviada"
   - Se erro: toast de erro + op√ß√£o de retry

5. INTERFACE VISUAL (ESTILO WHATSAPP):

Cores e estilos:
- Input background: #F0F2F5
- Bot√µes: circular, hover com background cinza claro
- Preview de arquivos: cards brancos com shadow sutil
- Grava√ß√£o de √°udio: background #FFF com border azul
- Waveform: ondas em azul (#2563EB)
- Timer: text-sm, cinza escuro

Anima√ß√µes:
- Smooth transitions em todos os estados
- Fade in/out dos previews
- Slide up do menu de anexos
- Pulse na grava√ß√£o de √°udio
- Skeleton loader durante upload

6. ATALHOS DE TECLADO:

- Enter: enviar mensagem (se n√£o est√° em composi√ß√£o de emoji)
- Shift+Enter: nova linha
- Ctrl/Cmd+V: colar imagem da √°rea de transfer√™ncia
- Esc: cancelar grava√ß√£o de √°udio ou fechar emoji picker

7. RESPONSIVIDADE:

Mobile (<768px):
- Input ocupa 100% da largura
- Preview de arquivos em coluna
- Menu de anexos como bottom sheet
- Bot√µes maiores (min 44px touch target)
- Emoji picker fullscreen

Desktop:
- Layout horizontal normal
- Preview inline
- Menu de anexos como popup
- Hover states vis√≠veis

8. INTEGRA√á√ÉO COM API:

Usar o servi√ßo api.ts j√° criado:

```typescript
// Upload de arquivo
const uploadResult = await api.uploadMidia(file, 'conversas');

// Enviar mensagem de texto
await api.enviarMensagem(
  conversaId, 
  clienteWhatsapp, 
  'text', 
  message
);

// Enviar mensagem com m√≠dia
await api.enviarMensagem(
  conversaId,
  clienteWhatsapp,
  'image', // ou 'video', 'audio', 'document'
  caption || '',
  uploadResult.url
);
```

9. ESTADOS E VALIDA√á√ïES:

- Desabilitar input durante envio
- Validar tamanho de arquivos antes de aceitar
- Validar formatos de arquivo
- Mostrar erro se microfone n√£o dispon√≠vel
- Timeout de 30s para uploads
- Retry autom√°tico em caso de falha de rede

10. BIBLIOTECAS NECESS√ÅRIAS:

Instalar:
```bash
npm install react-dropzone emoji-picker-react wavesurfer.js
```

Importar:
```typescript
import { useDropzone } from 'react-dropzone';
import EmojiPicker from 'emoji-picker-react';
import WaveSurfer from 'wavesurfer.js';
```

IMPORTANTE:
- Criar componente MessageInput.tsx separado e reutiliz√°vel
- Exportar e usar na tela de Conversas
- Seguir exatamente o comportamento do WhatsApp Web
- Testar todos os tipos de arquivo
- Garantir que funciona em mobile e desktop
- Implementar TODOS os recursos listados acima

O resultado deve ser id√™ntico ao WhatsApp em termos de UX e funcionalidade.
```

---

## ‚úÖ COLE ESSE PROMPT NO REPLIT E AGUARDE!

O Replit vai criar todo o sistema de envio de mensagens com:
- ‚úÖ Upload de fotos/v√≠deos/√°udios/documentos
- ‚úÖ Drag & drop
- ‚úÖ Preview de arquivos
- ‚úÖ Grava√ß√£o de √°udio com waveform
- ‚úÖ Emoji picker
- ‚úÖ Valida√ß√µes completas
- ‚úÖ Integra√ß√£o com API

**Me avisa quando terminar!** üöÄ