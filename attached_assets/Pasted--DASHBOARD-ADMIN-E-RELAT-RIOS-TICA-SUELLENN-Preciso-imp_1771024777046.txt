# ğŸ“Š DASHBOARD ADMIN E RELATÃ“RIOS - Ã“TICA SUELLENN

Preciso implementar um sistema completo de dashboard e relatÃ³rios para anÃ¡lise de dados do painel administrativo. Aqui estÃ¡ tudo que preciso:

---

## 1. PÃGINA: Dashboard Principal (src/pages/Dashboard.tsx)

Criar uma pÃ¡gina de dashboard com cards de mÃ©tricas e grÃ¡ficos.

### MÃ©tricas Principais (Cards no topo):

**Conversas:**
- Total de conversas (hoje, semana, mÃªs)
- Conversas ativas vs fechadas
- Tempo mÃ©dio de resposta
- Taxa de conversÃ£o (fechadas/total)
- Conversas por canal (WhatsApp, etc)

**Atendentes:**
- Conversas por atendente (hoje)
- Tempo mÃ©dio de atendimento por atendente
- Taxa de resoluÃ§Ã£o por atendente
- Atendentes online agora
- DistribuiÃ§Ã£o de carga (balanceamento)

**IA:**
- Mensagens enviadas pela IA (hoje, semana, mÃªs)
- Taxa de ativaÃ§Ã£o da IA (por motivo: horÃ¡rio, almoÃ§o, feriado)
- Conversas iniciadas pela IA
- Taxa de transferÃªncia IA â†’ Humano
- HorÃ¡rios de pico da IA

**Leads (Funil):**
- Total de leads por etapa do funil
- Taxa de conversÃ£o entre etapas
- Tempo mÃ©dio em cada etapa
- Leads quentes vs mornos vs frios
- Leads perdidos (motivos)

**Produtos:**
- Produtos mais procurados
- Leads por tipo de produto
- Ticket mÃ©dio por produto
- Taxa de conversÃ£o por produto

---

## 2. GRÃFICOS (usar recharts):

### GrÃ¡fico 1: Linha - Conversas ao longo do tempo
- Eixo X: Datas (Ãºltimos 30 dias)
- Eixo Y: NÃºmero de conversas
- Linhas: Total, Ativas, Fechadas, Perdidas

### GrÃ¡fico 2: Barras - Performance por Atendente
- Eixo X: Atendentes (Thamirys, Bruna)
- Eixo Y: NÃºmero de conversas
- Agrupado: Fechadas, Ativas, Tempo mÃ©dio

### GrÃ¡fico 3: Pizza - DistribuiÃ§Ã£o de Etiquetas de Funil
- Novo Lead
- Lead Qualificado
- OrÃ§amento Enviado
- NegociaÃ§Ã£o
- Agendado
- Fechado
- Perdido

### GrÃ¡fico 4: Pizza - Produtos de Interesse
- Ã“culos de Grau
- Ã“culos de Sol
- Lentes Progressivas
- Lentes Transition
- etc.

### GrÃ¡fico 5: Barras Horizontais - AtivaÃ§Ã£o da IA
- Por motivo: Fora de horÃ¡rio, AlmoÃ§o, Feriado, Domingo, Manual
- Quantidade de ativaÃ§Ãµes

### GrÃ¡fico 6: Ãrea - Mensagens por Hora do Dia
- Mostra picos de atendimento
- Ãštil para planejamento de horÃ¡rios

---

## 3. PÃGINA: RelatÃ³rios (src/pages/Relatorios.tsx)

Criar pÃ¡gina de relatÃ³rios com filtros e exportaÃ§Ã£o.

### Filtros DisponÃ­veis:

**PerÃ­odo:**
- Hoje
- Ãšltimos 7 dias
- Ãšltimos 30 dias
- Este mÃªs
- MÃªs passado
- Personalizado (data inÃ­cio e fim)

**Atendente:**
- Todas
- Thamirys
- Bruna

**Status da Conversa:**
- Todas
- Ativas
- Fechadas
- Arquivadas

**Etiquetas:**
- Todas
- Por tipo: Funil, Produto, Status
- MÃºltipla seleÃ§Ã£o

**Canal:**
- Todos
- WhatsApp

**Origem:**
- Todas
- IA
- Humano

---

### RelatÃ³rios Gerados:

**1. RelatÃ³rio de Conversas:**
```
Tabela com:
- ID da conversa
- Cliente (nome + WhatsApp)
- Atendente
- Status
- Etiquetas aplicadas
- Data de inÃ­cio
- Data de conclusÃ£o
- Tempo total
- NÃºmero de mensagens
- Origem (IA ou Humano iniciou)
```

**2. RelatÃ³rio de Performance por Atendente:**
```
- Nome da atendente
- Total de conversas
- Conversas fechadas
- Taxa de conversÃ£o
- Tempo mÃ©dio de atendimento
- Tempo mÃ©dio de primeira resposta
- Mensagens enviadas
- Conversas ativas agora
```

**3. RelatÃ³rio de Funil de Vendas:**
```
- Etapa do funil
- Quantidade de leads
- Taxa de conversÃ£o para prÃ³xima etapa
- Tempo mÃ©dio na etapa
- Taxa de abandono
```

**4. RelatÃ³rio de Produtos:**
```
- Produto
- NÃºmero de leads interessados
- Taxa de conversÃ£o
- Ticket mÃ©dio
- PerÃ­odo de maior procura
```

**5. RelatÃ³rio de IA:**
```
- Data/Hora de ativaÃ§Ã£o
- Motivo (horÃ¡rio, almoÃ§o, feriado)
- DuraÃ§Ã£o ativa
- Mensagens enviadas
- Conversas atendidas
- Taxa de transferÃªncia para humano
```

**6. RelatÃ³rio de Follow-Ups:**
```
- Conversas com follow-up agendado
- Follow-ups enviados
- Follow-ups pendentes
- Taxa de resposta apÃ³s follow-up
```

---

## 4. EXPORTAÃ‡ÃƒO DE DADOS:

BotÃµes para exportar relatÃ³rios:

**Formatos:**
- CSV (para Excel/Google Sheets)
- PDF (relatÃ³rio formatado)
- JSON (dados brutos)

**Biblioteca recomendada:**
- CSV: `react-csv` ou `papaparse`
- PDF: `jspdf` ou `react-to-pdf`

---

## 5. QUERIES SUPABASE NECESSÃRIAS:

### Query 1: MÃ©tricas Gerais
```typescript
// Total de conversas por perÃ­odo
const { data: conversas, count } = await supabase
  .from('conversas')
  .select('*', { count: 'exact' })
  .gte('created_at', dataInicio)
  .lte('created_at', dataFim);

// Conversas por status
const { data: porStatus } = await supabase
  .from('conversas')
  .select('status')
  .gte('created_at', dataInicio)
  .lte('created_at', dataFim);

// Agrupar manualmente no frontend
const stats = {
  ativas: porStatus.filter(c => c.status === 'ativa').length,
  fechadas: porStatus.filter(c => c.status === 'fechada').length
};
```

### Query 2: Performance por Atendente
```typescript
const { data: performance } = await supabase
  .from('conversas')
  .select(`
    id,
    status,
    tempo_total_atendimento,
    tempo_primeira_resposta,
    atendente_id,
    atendentes (nome)
  `)
  .gte('created_at', dataInicio)
  .lte('created_at', dataFim)
  .not('atendente_id', 'is', null);

// Agrupar por atendente no frontend
```

### Query 3: DistribuiÃ§Ã£o de Etiquetas
```typescript
const { data: etiquetas } = await supabase
  .from('conversas_etiquetas')
  .select(`
    conversa_id,
    etiquetas (nome, tipo, cor)
  `)
  .gte('created_at', dataInicio)
  .lte('created_at', dataFim);

// Agrupar por tipo de etiqueta
```

### Query 4: AtivaÃ§Ãµes da IA
```typescript
const { data: iaAtivacoes } = await supabase
  .from('conversas')
  .select('ia_ativa, ia_modo, created_at')
  .eq('ia_ativa', true)
  .gte('created_at', dataInicio)
  .lte('created_at', dataFim);

// Contar por ia_modo
```

### Query 5: Mensagens ao longo do tempo
```typescript
const { data: mensagens } = await supabase
  .from('mensagens')
  .select('created_at, direcao')
  .gte('created_at', dataInicio)
  .lte('created_at', dataFim)
  .order('created_at', { ascending: true });

// Agrupar por dia/hora
```

---

## 6. HOOKS CUSTOMIZADOS:

### src/hooks/useDashboardMetrics.ts
```typescript
export const useDashboardMetrics = (periodo: string) => {
  const [metrics, setMetrics] = useState({
    conversasTotal: 0,
    conversasAtivas: 0,
    conversasFechadas: 0,
    tempoMedioResposta: 0,
    taxaConversao: 0,
    // ... outras mÃ©tricas
  });

  useEffect(() => {
    // Buscar mÃ©tricas do Supabase
    // Calcular estatÃ­sticas
    // Atualizar estado
  }, [periodo]);

  return { metrics, loading };
};
```

### src/hooks/useRelatorio.ts
```typescript
export const useRelatorio = (filtros: FiltrosRelatorio) => {
  const [dados, setDados] = useState([]);
  
  const gerarRelatorio = async () => {
    // Aplicar filtros
    // Buscar dados
    // Processar e retornar
  };

  const exportarCSV = () => {
    // Converter para CSV
  };

  const exportarPDF = () => {
    // Gerar PDF
  };

  return { dados, gerarRelatorio, exportarCSV, exportarPDF, loading };
};
```

---

## 7. COMPONENTES NECESSÃRIOS:

### MetricCard.tsx
```typescript
interface MetricCardProps {
  title: string;
  value: number | string;
  subtitle?: string;
  icon?: React.ReactNode;
  trend?: 'up' | 'down' | 'neutral';
  trendValue?: string;
}
```

### ChartContainer.tsx
```typescript
// Wrapper para grÃ¡ficos recharts
// Com loading, empty state, error handling
```

### FiltrosRelatorio.tsx
```typescript
// Componente com todos os filtros
// Data picker, selects, checkboxes
```

### TabelaRelatorio.tsx
```typescript
// Tabela com dados do relatÃ³rio
// PaginaÃ§Ã£o, ordenaÃ§Ã£o, busca
```

### ExportButtons.tsx
```typescript
// BotÃµes de exportaÃ§Ã£o
// CSV, PDF, JSON
```

---

## 8. UTILITÃRIOS:

### src/utils/dateHelpers.ts
```typescript
export const periodos = {
  hoje: () => ({ inicio: startOfDay(new Date()), fim: endOfDay(new Date()) }),
  semana: () => ({ inicio: startOfWeek(new Date()), fim: endOfWeek(new Date()) }),
  mes: () => ({ inicio: startOfMonth(new Date()), fim: endOfMonth(new Date()) }),
  // etc
};

export const formatarData = (data: Date, formato: string) => {
  // FormataÃ§Ã£o de datas
};
```

### src/utils/chartHelpers.ts
```typescript
export const agruparPorDia = (dados: any[]) => {
  // Agrupar dados por dia
};

export const calcularTaxaConversao = (total: number, convertidos: number) => {
  return (convertidos / total * 100).toFixed(2);
};
```

### src/utils/exportHelpers.ts
```typescript
export const exportarParaCSV = (dados: any[], nomeArquivo: string) => {
  // LÃ³gica de exportaÃ§Ã£o CSV
};

export const exportarParaPDF = (dados: any[], config: PDFConfig) => {
  // LÃ³gica de exportaÃ§Ã£o PDF
};
```

---

## 9. LAYOUT SUGERIDO:

```
/dashboard
  â”œâ”€ Header com perÃ­odo selecionado
  â”œâ”€ Grid de cards de mÃ©tricas (4 colunas)
  â”œâ”€ Linha de grÃ¡ficos principais (2 colunas)
  â””â”€ Tabela de Ãºltimas conversas

/relatorios
  â”œâ”€ Sidebar com filtros
  â”œâ”€ Ãrea principal com:
  â”‚   â”œâ”€ BotÃµes de exportaÃ§Ã£o (topo)
  â”‚   â”œâ”€ Tabela de resultados
  â”‚   â””â”€ PaginaÃ§Ã£o
  â””â”€ GrÃ¡ficos relacionados (abaixo da tabela)
```

---

## 10. BIBLIOTECAS NECESSÃRIAS:

```bash
# Se nÃ£o tiver instalado
npm install recharts
npm install date-fns
npm install react-csv
npm install jspdf
npm install react-to-print
npm install lucide-react
```

---

## 11. PERMISSÃ•ES E SEGURANÃ‡A:

**Importante:** Dashboard e relatÃ³rios devem ser acessÃ­veis apenas para:
- Administradores
- Ou verificar papel do usuÃ¡rio logado

```typescript
// Verificar se usuÃ¡rio Ã© admin
const { data: user } = await supabase.auth.getUser();
const { data: atendente } = await supabase
  .from('atendentes')
  .select('papel')
  .eq('email', user.email)
  .single();

if (atendente.papel !== 'admin') {
  // Redirecionar ou mostrar erro
}
```

---

## 12. EXEMPLOS DE MÃ‰TRICAS INTERESSANTES:

**AnÃ¡lise de HorÃ¡rios:**
- HorÃ¡rio de pico de mensagens
- Melhor horÃ¡rio de conversÃ£o
- Quando a IA Ã© mais ativada

**AnÃ¡lise de Comportamento:**
- Tempo mÃ©dio atÃ© primeira resposta do cliente
- Quantidade de mensagens atÃ© fechamento
- Taxa de abandono por etapa do funil

**AnÃ¡lise de Produtos:**
- Produto com maior ticket mÃ©dio
- Produto com melhor taxa de conversÃ£o
- CombinaÃ§Ãµes de produtos mais vendidas

**AnÃ¡lise de Atendentes:**
- Quem fecha mais rÃ¡pido
- Quem tem melhor taxa de conversÃ£o
- DistribuiÃ§Ã£o justa de conversas

**ROI da IA:**
- Quantas conversas a IA atendeu que seriam perdidas
- Economia de tempo das atendentes
- Taxa de satisfaÃ§Ã£o com IA vs Humano (se coletar)

---

Por favor, implemente este sistema completo de dashboard e relatÃ³rios, mantendo a estrutura existente do projeto e seguindo as boas prÃ¡ticas de React e TypeScript.

Crie todos os componentes, hooks, pÃ¡ginas e utilitÃ¡rios necessÃ¡rios. Use Tailwind CSS para estilizaÃ§Ã£o e mantenha consistÃªncia com o design atual.

Priorize: performance nas queries, UX intuitiva, grÃ¡ficos responsivos e exportaÃ§Ãµes funcionais.